# WebRTC

* [WebRTC란?](#webrtc란?)
* [WebRTC의 기술 및 프로토콜](#webrtc의-기술-및-프로토콜)



## WebRTC란?

- WebRTC는 웹 브라우저 환경 및 Andriod, IOS 애플리케이션에서도 사용 가능한 비디오, 음성 및 일반 데이터가 피어간에 실시간으로 전송되도록 지원하는 오픈 소스

- 공개 웹 표준으로 구현, 모든 주요 브라우저에서 일반 JavaScript API로 제공



## WebRTC의 기술 및 프로토콜

### ICE

- 브라우저가 peer를 통한 연결이 가능하게 해주는 프레임워크



#### Peer간 단순 연결 시 작동하지 않는 이유

1. 연결을 시도하는 방화벽을 통과해야 함
2. 단말에 Public IP가 없다면 유일한 주소값 할당이 필요
3. 라우터가 Peer간의 직접 연결을 허용하지 않을 때 데이터 릴레이 하는 경우



##### ICE는 위의 작업들을 수행하기 위해 STUN, TURN 서버 둘 다 혹은 하나의 서버를 사용한다



### STUN 서버

- 클라이언트 **자신의 Public Address(IP:PORT) 를 알려준다**

- peer간의 직접 연결을 막는 등의 라우터의 제한을 결정하는 프로토콜
  - 현재 다른 peer가 접근 가능한지 여부 결정
  
- 클라는 인터넷을 통해 클라의 Public Address와 라우터의 NAT 뒤에 있는 클라가 접근 가능한지에 대한 답변을 STUN서버에 요청

  ![STUN Server](https://user-images.githubusercontent.com/41468004/126253431-2735b62a-8954-4ed8-a29f-bdae0c65208d.png)



### NAT

- 단말에게 **Public IP주소를 할당**하기 위해 사용
- 인터넷의 공인 IP주소는 한정되어 있기에 가급적 이를 공유할 수 있도록 하는게 필요
  - NAT을 이용하여 사설 IP사용함과 동시에 이를 공인IP로 상호변환 가능하게 => 다수의 사설IP사용자들이 공인IP를 사용함으로 IP절약 가능
- 공개된 인터넷과 사설망 사이에 방화벽 설치해 **외부 공격으로부터 사용자의 통신망 보호 가능**
  - 외부 통신망과 연결되는 라우터에 NAT을 설정하면 라우터는 자신에게 할당된 공인 IP만 외부로 알려지게 함
  - 라우터 안쪽에서는 사설 IP만 사용함으로 공인 주소 <=> 사설 주소 상호변환
  - 외부에서 내부 공격 위해서는 사설IP를 알아야하는데 이것이 불가능



- 몇몇 라우터들은 **Symmetric NAT** 이라고 불리는 **제한을 위한 NAT** 을 채용
  - 이로 인해 **peer들은 오직 이전에 연결한 적 있는 연결들만 허용**
  - 따라서 **STUN 서버**에 의해 공개 IP를 발견했다고 해도 모두 연결 가능한건 아님 => **TURN 서버** 필요



### TURN 서버

- **TURN 서버와 연결, 모든 정보를 그 서버에 전달**하여 **Symmetric NAT 제한을 우회**하는 것을 의미

- **TURN 서버와 연결**한 후 **모든 peer들에게 저 서버에게 모든 패킷을 보내고 다시 나(TURN서버)에게 전달**

- 명백히 오버헤드가 발생하기에 다른 대안이 없을떄 사용해야함

  [![TURN Server](https://user-images.githubusercontent.com/41468004/126253493-d19be8ef-e51e-4be5-882b-d5a395e67361.png)](#https://user-images.githubusercontent.com/41468004/126253493-d19be8ef-e51e-4be5-882b-d5a395e67361.png)



### Kurento

- 전체 WebRTC 스택의 기능적 구현을 제공하는 미디어 서버 및 Open API

