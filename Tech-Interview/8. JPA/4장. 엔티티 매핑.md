# 엔티티 매핑

## 4.1 @Entity

> JPA를 이용해서 테이블과 매핑할 클래스는 @Entity를 명시해줘야함
>
> 즉 JPA의 관리대상이 된다

- name 설정하지 않으면 default로 클래스명 들어간다
- 기본 생성자는 필수
  - JPA가 엔티티 객체 생성시 생성자 사용하기 때문
- 저장할 필드에 final은 사용하면 안됨



## 4.2 @Table

> 엔티티와 매핑할 테이블을 지정



## 4.4 DB 스키마 자동 생성

> JPA는 데이터베이스 스키마 자동 생성 기능을 제공한다

- 애플리케이션 실행 시점에 데이터베이스 테이블을 자동으로 생성
- 네이밍 policy의 경우 보통
  - DB에서는 언더스코어(column_one, column_two)
  - Entity는 카멜표기법(columnOne, columnTwo)



## 4.6 기본키 매핑

#### 직접 할당

> 기본키를 애플리케이션에서 직접 할당
>
> @Id로 지정



#### 자동 생성

> 대리 키 사용 방식
>
> @GeneratedValue 추가 하고 원하는 전략 선택하면 된다



##### 자동 생성 전략

- IDENTITY
  - 기본 키 생성을 데이터베이스에게 위임하는 형식
    - ex) MySQL에서는 AUTO_INCREMENT로 생성
  - 이 방식은 객체가 데이터베이스에 저장되고 나서야 식별키가 발급되므로 DB에 저장되고 나서야 해당 식별자 키를 읽을 수 있다
- SEQUENCE
  - 유일한 값을 순서대로 생성한 특별한 데이터베이스 오브젝트이다
  - 처리 순서
    - em.persist 수행 시 DB 시퀀스를 이용해 식별자를 조회
    - 조회된 식별자를 entity에 할당
    - 그 후 영속성 컨텍스트에 entity 저장
    - 이후 트랜잭션 커밋 발생시에 엔티티를 DB에 저장한다
  - IDENTIY와의 차이점
    - IDENTITY: 데이터베이스에 미리 저장하고 꺼내와주는 방식
    - SEQUENCE: 식별자만 꺼내와서 일단 보여주고 나중에 트랜잭션 발생하면 식별자 포함된 엔티티 저장
- TABLE
  - 키 생성 전용 테이블
  - 이름과 값으로 사용할 컬럼을 만들어 SEQUENCE를 흉내내는 전략
- AUTO
  - DB 방언에 따라 위 세가지 방식중 하나 알아서 채택되게끔